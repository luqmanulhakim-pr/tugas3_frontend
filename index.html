<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Toko Outdoor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body class="bg-gray-50 font-sans leading-normal tracking-normal">
    <!-- Header -->
    <header class="bg-green-700 text-white shadow-md">
      <div class="container mx-auto flex justify-between items-center p-4">
        <h1 class="text-2xl font-bold">
          <i class="fas fa-mountain"></i> Aljabar Outdoor
        </h1>
        <nav>
          <ul class="flex space-x-4">
            <li><a href="#" class="hover:text-green-200">Home</a></li>
            <li><a href="#" class="hover:text-green-200">Produk</a></li>
            <li><a href="#" class="hover:text-green-200">Tentang</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- Main -->
    <main class="container mx-auto p-6">
      <!-- Status -->
      <div id="status" class="hidden mb-6 p-4 rounded-lg"></div>

      <div class="text-2xl font-bold mb-4 text-gray-800">List Produk Kami</div>
      <!-- Stats Produk -->
      <div
        id="stats"
        class="hidden mb-6 p-4 rounded-lg bg-green-50 border border-green-200 text-green-700"
      >
        Total Produk: <span id="totalProducts">0</span>
      </div>

      <!-- Grid Produk -->
      <div
        id="produkGrid"
        class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"
      >
        <!-- produk akan ditampilkan di sini -->
      </div>
    </main>

    <script>
      // Endpoint backend Flask
      const DEFAULT_ENDPOINTS = [
        "http://127.0.0.1:5000",
        "http://3.106.210.182:5000",
      ];

      // Tampilkan status pesan
      function showStatus(message, type = "info") {
        const statusDiv = document.getElementById("status");
        statusDiv.textContent = message;
        statusDiv.className =
          "mb-6 p-4 rounded-lg " +
          (type === "success"
            ? "bg-green-100 text-green-800 border border-green-300"
            : type === "error"
            ? "bg-red-100 text-red-800 border border-red-300"
            : "bg-blue-100 text-blue-800 border border-blue-300");
        statusDiv.classList.remove("hidden");
      }

      // Update statistik produk
      function updateStats(total) {
        const statsDiv = document.getElementById("stats");
        const totalDiv = document.getElementById("totalProducts");
        totalDiv.textContent = total;
        statsDiv.classList.remove("hidden");
      }

      // Render produk ke grid
      function renderProduk(produkList) {
        const grid = document.getElementById("produkGrid");
        grid.innerHTML = "";

        produkList.forEach((p) => {
          const card = document.createElement("div");
          card.className =
            "bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition";

          card.innerHTML = `
          <img src="${p.foto}" alt="${
            p.nama_produk
          }" class="w-full h-48 object-cover">
          <div class="p-4">
            <h2 class="text-lg font-bold mb-2">${p.nama_produk}</h2>
            <p class="text-gray-600 mb-2">${p.deskripsi}</p>
            <p class="text-green-700 font-bold mb-2">Rp ${p.harga.toLocaleString(
              "id-ID"
            )}</p>
            <span class="inline-block bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">${
              p.kategori
            }</span>
          </div>
        `;

          grid.appendChild(card);
        });
      }

      // Coba connect ke endpoint backend
      async function tryDefaultEndpoints() {
        for (let endpoint of DEFAULT_ENDPOINTS) {
          try {
            showStatus("üì° Menghubungkan ke server...", "loading");

            const res = await fetch(`${endpoint}/produk`);
            if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
            const data = await res.json();

            if (data.status === "success") {
              renderProduk(data.data);
              updateStats(data.total);
              showStatus(`‚úÖ Terhubung ke backend: ${endpoint}`, "success");
              return;
            }
          } catch (err) {
            console.error(`Gagal connect ke ${endpoint}`, err);
            showStatus(`‚ùå Gagal connect ke ${endpoint}`, "error");
          }
        }
        showStatus("üö® Semua endpoint gagal dihubungi!", "error");
      }

      // Eksekusi awal
      tryDefaultEndpoints();
    </script>
  </body>
</html>
